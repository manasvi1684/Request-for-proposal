
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// Global status enum for RFPs


// Vendor model: Represents a supplier in the system
model Vendor {
  id          Int        @id @default(autoincrement())
  name        String
  email       String     @unique // Unique email for identification
  contactInfo String?    // Optional phone or address
  notes       String?    // Internal notes about the vendor
  createdAt   DateTime   @default(now())
  
  proposals   Proposal[] // Relation to proposals
}

// RFP model: The Request for Proposal created by the user
model Rfp {
  id               Int        @id @default(autoincrement())
  title            String
  description      String     // Original natural language text from user
  budget           Float?     
  currency         String     @default("USD")
  deliveryDeadline DateTime?
  status           String     @default("DRAFT")
  structuredData   String     // JSON string of AI-extracted requirements. SQLite doesn't support JSON type natively in Prisma so we use String.
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  proposals        Proposal[]
}

// Proposal model: A vendor's response to an RFP
model Proposal {
  id                Int      @id @default(autoincrement())
  rfpId             Int
  vendorId          Int
  rawText           String   // The original email body or pasted text
  parsedData        String   // JSON string of AI-extracted proposal details
  totalPrice        Float?
  currency          String?
  deliveryDays      Int?
  warrantyMonths    Int?
  paymentTerms      String?
  completenessScore Float?   // 0-1 score indicating if all requirements are met
  overallScore      Float?   // 0-100 calculated score
  aiExplanation     String?  // AI's qualitative analysis
  createdAt         DateTime @default(now())

  rfp    Rfp    @relation(fields: [rfpId], references: [id])
  vendor Vendor @relation(fields: [vendorId], references: [id])

  @@index([rfpId])
  @@index([vendorId])
}
